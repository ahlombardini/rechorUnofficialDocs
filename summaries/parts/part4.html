<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Étape 4 - ReCHor Documentation</title>
    <style>
        :root {
            --primary-color: #1976D2;
            --secondary-color: #2196F3;
            --accent-color: #4CAF50;
            --background-color: #f5f5f5;
            --text-color: #333;
        }

        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            color: var(--text-color);
            background: var(--background-color);
        }

        .header {
            background: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            margin-bottom: 2rem;
        }

        .header a {
            color: white;
            text-decoration: none;
            display: inline-block;
        }

        .header a:hover {
            text-decoration: underline;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        h2 {
            color: var(--primary-color);
            margin-top: 0;
        }

        .card-title {
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            margin: 0 0 1rem 0;
            color: var(--primary-color);
            font-size: 1.2rem;
        }

        .class-card .card-title {
            margin: 0;
        }

        .class-card, .concept-card {
            min-height: 100px;
            height: fit-content;
            display: flex;
            flex-direction: column;
            background: white;
            padding: 1.5rem;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .concept-card {
            margin-bottom: 1rem;
        }

        .concept-card:hover, .class-card:hover {
            transform: translateY(-2px);
        }

        .concept-content {
            font-size: 0.95em;
            color: var(--text-color);
            overflow: auto;
            max-height: 300px;
            margin-top: 0.5rem;
        }

        .concept-content p {
            margin: 0.5rem 0;
        }

        .concept-content ol, .concept-content ul {
            margin: 0.5rem 0;
            padding-left: 1.5rem;
        }

        .concept-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin: 1rem 0;
            list-style: none;
            padding: 0;
        }

        .concept-content a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .concept-content a:hover {
            text-decoration: underline;
        }

        .concepts-section {
            margin: 2rem 0;
        }

        .concepts-section h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .class-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 1rem 0;
        }

        .class-card a {
            text-decoration: none;
        }

        .introduction {
            background: white;
            padding: 2rem;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .subtitle {
            font-style: italic;
            color: var(--secondary-color);
            margin: 1rem 0;
        }

        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 1rem auto;
        }

        figure {
            margin: 2rem 0;
            text-align: center;
        }

        figcaption {
            font-style: italic;
            color: var(--text-color);
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <header class="header">
        <a href="../index.html">← Retour à l'index</a>
    </header>
    <div class="container">
        <h2>Étape 4 - Horaire aplati</h2>
<p class="subtitle">ReCHor – étape 4</p>
            <div class="introduction">
                <div class="outline-text-2" id="text-1">
<p>
Le but de cette étape est d'écrire des classes facilitant la lecture des données horaires aplaties, et de les utiliser pour écrire celles permettant de manipuler les gares et voies représentées de cette manière.
</p>
</div>
            </div>
        
                <div class="concepts-section">
                    <h3>Concepts clés</h3>
                    <div class="concept-grid">
            
        <div class="concept-card">
            <h3 class="card-title">Données aplaties</h3>
            <div class="concept-content"><div class="outline-text-3" id="text-2-1">
<p>
Comme nous l'avons vu à l'étape précédente, les données horaire utilisées dans ce projet sont représentées d'une manière un peu particulière, que nous avons appelée <b>aplatie</b>.
</p>
<p>
L'idée de cette représentation est que les différents types de données de l'horaire (gares, voies/quais, liaisons, etc.) sont stockés dans des tableaux, chaque tableau contenant toutes les valeurs d'un type donné, p. ex. toutes les gares. De plus, au lieu de contenir des références vers des objets contenant les attributs des différentes instances — comme d'habitude en Java — ces tableaux contiennent directement les attributs des différentes instances.
</p>
<p>
À l'étape 3, pour simplifier les choses, nous avions fait l'hypothèse que les données représentées de manière aplatie étaient homogènes, dans le sens où tous leurs attributs pouvaient être représentés au moyen d'entiers du même type. Ainsi, dans l'exemple de la §2.1.3 de cette étape, les liaisons étaient composée de 4 attributs, et chacun d'entre eux pouvait être représenté au moyen d'un entier de type <code>short</code>. La totalité des liaisons pouvait donc être stockée dans un unique tableau de type <code>short[]</code>, de taille égale à 4 fois le nombre de liaisons.
</p>
<p>
En réalité, les données aplaties que nous utiliserons dans ce projet seront hétérogènes, dans le sens où elles seront constituées d'un certain nombre d'attributs ayant chacun un type potentiellement différent. Nous nommerons ces attributs des <b>champs</b> (<i>fields</i>), et ils pourront être chacun d'un des trois types entiers suivant :
</p>
<dl class="org-dl">
<dt><code>U8</code></dt><dd>8 bits (1 octet) interprétés comme un entier non signé, compris donc entre 0 (inclus) et 256 (exclu),</dd>
<dt><code>U16</code></dt><dd>16 bits (2 octets) interprétés comme un entier non signé, compris donc entre 0 (inclus) et 65 536 (exclu),</dd>
<dt><code>S32</code></dt><dd>32 bits (4 octets) interprétés comme un entier signé, compris donc entre<br/>
–2 147 483 648 (inclus) et 2 147 483 648 (exclu).</dd>
</dl>
<p>
Ces trois types correspondent presque aux types <code>byte</code>, <code>short</code> et <code>int</code> de Java, la seule différence étant que les deux premiers sont interprétés de manière non signée.
</p>
<p>
Les données hétérogènes sont stockées dans des tableaux d'octets (<i>bytes</i>), et un champ de type <code>U8</code> occupe donc un seul élément d'un tel tableau, un champ de type <code>U16</code> en occupe deux consécutifs, et un champ de type <code>S32</code> en occupe quatre consécutifs.
</p>
<p>
Comme les trois types de champs sont tous des types entiers, il faut trouver une manière de représenter <i>toutes</i> les données de l'horaire au moyen d'entiers, entre autres les nombreuses chaînes de caractères qu'elles contiennent.
</p>
</div></div>
        </div>
    
        <div class="concept-card">
            <h3 class="card-title">Table des chaînes de caractères</h3>
            <div class="concept-content"><div class="outline-text-3" id="text-2-2">
<p>
De nombreuses données de l'horaire contiennent des chaînes de caractères, p. ex. les gares ont un nom qui est une chaîne, et il en va de même pour les voies ou quais, les courses, etc.
</p>
<p>
Pour pouvoir représenter ces chaînes de caractères dans des données aplaties, une solution simple consiste à établir une table de toutes les chaînes présentes dans les données, puis d'identifier une chaîne par son index dans cette table.
</p>
<p>
Les données horaires que nous utiliserons contiennent un peu plus de 40 000 chaînes différentes, et un index dans cette table peut donc être représenté par une valeur de type <code>U16</code>. Dans ce qui suit, nous nommerons ces index des <b>index de chaîne</b>.
</p>
</div></div>
        </div>
    
        <div class="concept-card">
            <h3 class="card-title">Gares</h3>
            <div class="concept-content"><div class="outline-text-3" id="text-sec/stations">
<p>
Les gares sont représentées de manière aplatie au moyen des trois champs donnés dans la table ci-dessous, la colonne <code>I</code> donnant l'index du champ (à partir de 0) :
</p>
<table>
<colgroup>
<col class="org-right"/>
<col class="org-left"/>
<col class="org-left"/>
<col class="org-left"/>
</colgroup>
<thead>
<tr>
<th class="org-right" scope="col"><code>I</code></th>
<th class="org-left" scope="col">Champ</th>
<th class="org-left" scope="col">Type</th>
<th class="org-left" scope="col">Contenu</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-left"><code>NAME_ID</code></td>
<td class="org-left"><code>U16</code></td>
<td class="org-left">Index de chaîne du nom de la gare</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-left"><code>LON</code></td>
<td class="org-left"><code>S32</code></td>
<td class="org-left">Longitude de la gare</td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-left"><code>LAT</code></td>
<td class="org-left"><code>S32</code></td>
<td class="org-left">Latitude de la gare</td>
</tr>
</tbody>
</table>
<p>
La représentation aplatie d'une gare nécessite donc 10 octets (sans compter ceux nécessaires à la représentation des chaînes dans la table des chaînes), et le tableau d'octets contenant la totalité des gares a donc une taille égale à 10 fois le nombre de gares.
</p>
<p>
La longitude et la latitude d'une gare aplatie ne sont <i>pas</i> exprimées en degrés, mais dans une unité anonyme, équivalente à \(360°\div 2^{32}\). En d'autres termes, une longitude ou une latitude \(l\) exprimée dans cette unité anonyme peut être convertie en sa version en degrés \(l°\) au moyen de la formule suivante :
</p>
<p>
\[ l° = \frac{360}{2^{32}}\,l \]
</p>
<p>
L'intérêt de cette unité est qu'elle permet de représenter les longitudes et latitudes au moyen d'entiers de 32 bits, avec une précision de l'ordre du centimètre. En effet, sachant qu'à l'équateur la Terre a une circonférence d'environ 40 000 km, la précision est d'au moins :
</p>
<p>
\[ \frac{40\,000}{2^{32}}\,\textrm{km} \approx 0.93\,\textrm{cm} \]
</p>
<p>
ce qui suffit très largement à nos besoins.
</p>
</div></div>
        </div>
    
        <div class="concept-card">
            <h3 class="card-title">Noms alternatifs des gares</h3>
            <div class="concept-content"><div class="outline-text-3" id="text-sec/aliases">
<p>
Comme nous l'avons vu, certaines gares ont des noms alternatifs qui doivent pouvoir être utilisés dans la recherche d'arrêts, p. ex. <i>Losanna</i> pour <i>Lausanne</i>, <i>Soleure</i> pour <i>Solothurn</i>, <a href="https://fr.wikipedia.org/wiki/Anet_(Berne)"><i>Anet</i></a> pour <a href="https://de.wikipedia.org/wiki/Ins_BE"><i>Ins</i></a>, etc.
</p>
<p>
Ces noms alternatifs sont représentés comme des paires composées du nom alternatif et du nom original. La structure de cette table est donc très simple :
</p>
<table>
<colgroup>
<col class="org-right"/>
<col class="org-left"/>
<col class="org-left"/>
<col class="org-left"/>
</colgroup>
<thead>
<tr>
<th class="org-right" scope="col"><code>I</code></th>
<th class="org-left" scope="col">Champ</th>
<th class="org-left" scope="col">Type</th>
<th class="org-left" scope="col">Contenu</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-left"><code>ALIAS_ID</code></td>
<td class="org-left"><code>U16</code></td>
<td class="org-left">Index de chaîne du nom alternatif</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-left"><code>STATION_NAME_ID</code></td>
<td class="org-left"><code>U16</code></td>
<td class="org-left">Index de chaîne du nom de la gare</td>
</tr>
</tbody>
</table>
<p>
La représentation aplatie d'un nom alternatif d'une gare nécessite donc 4 octets.
</p>
</div></div>
        </div>
    
        <div class="concept-card">
            <h3 class="card-title">Voies ou quais</h3>
            <div class="concept-content"><div class="outline-text-3" id="text-sec/platforms">
<p>
Les voies ou quai ont un nom (p. ex. <code>70</code>, <code>1AB</code>, <code>A</code>) et une référence vers la gare à laquelle ils appartiennent, que nous appellerons la <b>gare parente</b> (<i>parent station</i>).
</p>
<table>
<colgroup>
<col class="org-right"/>
<col class="org-left"/>
<col class="org-left"/>
<col class="org-left"/>
</colgroup>
<thead>
<tr>
<th class="org-right" scope="col"><code>I</code></th>
<th class="org-left" scope="col">Champ</th>
<th class="org-left" scope="col">Type</th>
<th class="org-left" scope="col">Contenu</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-left"><code>NAME_ID</code></td>
<td class="org-left"><code>U16</code></td>
<td class="org-left">Index de chaîne du nom de la voie ou du quai</td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-left"><code>STATION_ID</code></td>
<td class="org-left"><code>U16</code></td>
<td class="org-left">Index de la gare parente</td>
</tr>
</tbody>
</table>
<p>
La représentation aplatie d'une voie ou d'un quai nécessite donc 4 octets.
</p>
<p>
Il est important de comprendre que le premier champ (<code>NAME_ID</code>) contient un index dans la table des chaînes, mais le second (<code>STATION_ID</code>) contient un index dans la table des gares, et pas dans celle des chaînes !
</p>
</div></div>
        </div>
    
        <div class="concept-card">
            <h3 class="card-title">Exemple</h3>
            <div class="concept-content"><div class="outline-text-3" id="text-sec/example">
<p>
Pour illustrer la représentation aplatie des gares, de leurs noms alternatifs et des gares ou quais, admettons que la table des chaînes de caractères contienne les éléments suivants :
</p>
<table>
<colgroup>
<col class="org-right"/>
<col class="org-left"/>
</colgroup>
<thead>
<tr>
<th class="org-right" scope="col"><code>I</code></th>
<th class="org-left" scope="col">Chaîne</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">0</td>
<td class="org-left"><code>1</code></td>
</tr>
<tr>
<td class="org-right">1</td>
<td class="org-left"><code>70</code></td>
</tr>
<tr>
<td class="org-right">2</td>
<td class="org-left"><code>Anet</code></td>
</tr>
<tr>
<td class="org-right">3</td>
<td class="org-left"><code>Ins</code></td>
</tr>
<tr>
<td class="org-right">4</td>
<td class="org-left"><code>Lausanne</code></td>
</tr>
<tr>
<td class="org-right">5</td>
<td class="org-left"><code>Losanna</code></td>
</tr>
<tr>
<td class="org-right">6</td>
<td class="org-left"><code>Palézieux</code></td>
</tr>
</tbody>
</table>
<p>
et voyons ensuite comment représenter des gares, noms alternatifs et voies/quai aplatis.
</p>
</div></div>
        </div>
    
                    </div>
                </div>
            
            <div class="class-section">
                <h3>Classes et Interfaces</h3>
                <div class="class-grid">
        
        <div class="class-card">
            <a href="classes/Structure.html">
                <h3 class="card-title">Structure</h3>
            </a>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.9em;">3.1. Classe Structure</p>
        </div>
    
        <div class="class-card">
            <a href="classes/StructuredBuffer.html">
                <h3 class="card-title">StructuredBuffer</h3>
            </a>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.9em;">3.2. Classe StructuredBuffer</p>
        </div>
    
        <div class="class-card">
            <a href="classes/BufferedStations.html">
                <h3 class="card-title">BufferedStations</h3>
            </a>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.9em;">3.3. Classe BufferedStations</p>
        </div>
    
        <div class="class-card">
            <a href="classes/BufferedStationAliases.html">
                <h3 class="card-title">BufferedStationAliases</h3>
            </a>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.9em;">3.4. Classe BufferedStationAliases</p>
        </div>
    
        <div class="class-card">
            <a href="classes/BufferedPlatforms.html">
                <h3 class="card-title">BufferedPlatforms</h3>
            </a>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.9em;">3.5. Classe BufferedPlatforms</p>
        </div>
    
                </div>
            </div>
        
            </div>
        </body>
        </html>
        