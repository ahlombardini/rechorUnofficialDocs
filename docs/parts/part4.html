<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Étape 4 - ReCHor Documentation</title>
    <style>
        :root {
            --primary-color: #1976D2;
            --secondary-color: #2196F3;
            --accent-color: #4CAF50;
            --background-color: #f5f5f5;
            --text-color: #333;
        }

        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            color: var(--text-color);
            background: var(--background-color);
        }

        .header {
            background: var(--primary-color);
            color: white;
            padding: 1rem 2rem;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
        }

        .header a {
            color: white;
            text-decoration: none;
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .header a:hover {
            background-color: rgba(255, 255, 255, 0.1);
            text-decoration: none;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        h2 {
            color: var(--primary-color);
            margin-top: 0;
        }

        .card-title {
            word-wrap: break-word;
            overflow-wrap: break-word;
            hyphens: auto;
            margin: 0 0 1rem 0;
            color: var(--primary-color);
            font-size: 1.2rem;
        }

        .class-card, .concept-card {
            background: white;
            padding: 1.5rem;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.2s ease-in-out;
            margin-bottom: 1rem;
        }

        .class-card:hover, .concept-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .card-title {
            margin: 0 0 1rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #eee;
        }

        .card-title a {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 1.2rem;
        }

        .card-title a:hover {
            color: var(--secondary-color);
        }

        .class-content, .concept-content {
            font-size: 0.95em;
            color: var(--text-color);
            overflow: auto;
            max-height: 500px;
            padding-right: 1rem;
        }

        .class-content p, .concept-content p {
            margin: 0.5rem 0;
        }

        .class-content pre, .concept-content pre {
            background: var(--background-color);
            padding: 1rem;
            border-radius: 4px;
            overflow-x: auto;
            margin: 1rem 0;
        }

        .class-grid, .concept-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 1.5rem;
            margin: 1rem 0;
        }

        .class-card .card-title {
            margin: 0;
        }

        .class-card, .concept-card {
            min-height: 100px;
            height: fit-content;
            display: flex;
            flex-direction: column;
            background: white;
            padding: 1.5rem;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .concept-card {
            margin-bottom: 1rem;
        }

        .concept-card:hover, .class-card:hover {
            transform: translateY(-2px);
        }

        .concept-content {
            font-size: 0.95em;
            color: var(--text-color);
            overflow: auto;
            max-height: 300px;
            margin-top: 0.5rem;
        }

        .concept-content p {
            margin: 0.5rem 0;
        }

        .concept-content ol, .concept-content ul {
            margin: 0.5rem 0;
            padding-left: 1.5rem;
        }

        .concept-content a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .concept-content a:hover {
            text-decoration: underline;
        }

        .concepts-section {
            margin: 2rem 0;
        }

        .concepts-section h3 {
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .class-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 1rem 0;
        }

        .class-card a {
            text-decoration: none;
        }

        .introduction {
            background: white;
            padding: 2rem;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .subtitle {
            font-style: italic;
            color: var(--secondary-color);
            margin: 1rem 0;
        }

        img {
            max-width: 100%;
            height: auto;
            display: block;
            margin: 1rem auto;
        }

        figure {
            margin: 2rem 0;
            text-align: center;
        }

        figcaption {
            font-style: italic;
            color: var(--text-color);
            margin-top: 0.5rem;
        }

        .concept-preview {
            color: var(--text-color);
            font-size: 0.9em;
            margin-top: 0.5rem;
            opacity: 0.8;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .concept-card {
            min-height: 100px;
            height: fit-content;
            background: white;
            padding: 1.5rem;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.2s ease-in-out;
        }

        .concept-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .concept-card a {
            text-decoration: none;
            color: inherit;
            display: block;
            height: 100%;
        }
    </style>
</head>
<body>
    <header class="header">
        <a href="../index.html">← Retour à l'index</a>
    </header>
    <div class="container">
        <h2>Étape 4 - Horaire aplati</h2>
<p class="subtitle">ReCHor – étape 4</p>

            <div class="introduction">
                <div class="outline-text-2" id="text-1">
<p>
Le but de cette étape est d'écrire des classes facilitant la lecture des données horaires aplaties, et de les utiliser pour écrire celles permettant de manipuler les gares et voies représentées de cette manière.
</p>
</div>
            </div>
        
                <div class="concepts-section">
                    <h3>Concepts clés</h3>
                    <div class="concept-grid">
            
        <div class="concept-card">
            <h3 class="card-title">
                <a href="../concepts/part4_donnees_aplaties.html">Données aplaties</a>
            </h3>
            <div class="concept-preview">Comme nous l'avons vu à l'étape précédente, les données horaire utilisées dans ce projet sont rep...</div>
        </div>
    
        <div class="concept-card">
            <h3 class="card-title">
                <a href="../concepts/part4_table_des_chanes_de_caracteres.html">Table des chaînes de caractères</a>
            </h3>
            <div class="concept-preview">De nombreuses données de l'horaire contiennent des chaînes de caractères, p. ex. les gares ont un...</div>
        </div>
    
        <div class="concept-card">
            <h3 class="card-title">
                <a href="../concepts/part4_gares.html">Gares</a>
            </h3>
            <div class="concept-preview">Les gares sont représentées de manière aplatie au moyen des trois champs donnés dans la table ci-...</div>
        </div>
    
        <div class="concept-card">
            <h3 class="card-title">
                <a href="../concepts/part4_noms_alternatifs_des_gares.html">Noms alternatifs des gares</a>
            </h3>
            <div class="concept-preview">Comme nous l'avons vu, certaines gares ont des noms alternatifs qui doivent pouvoir être utilisés...</div>
        </div>
    
        <div class="concept-card">
            <h3 class="card-title">
                <a href="../concepts/part4_voies_ou_quais.html">Voies ou quais</a>
            </h3>
            <div class="concept-preview">Les voies ou quai ont un nom (p. ex. 70, 1AB, A) et une référence vers la gare à laquelle ils app...</div>
        </div>
    
        <div class="concept-card">
            <h3 class="card-title">
                <a href="../concepts/part4_exemple.html">Exemple</a>
            </h3>
            <div class="concept-preview">Pour illustrer la représentation aplatie des gares, de leurs noms alternatifs et des gares ou qua...</div>
        </div>
    
                    </div>
                </div>
        
                <div class="class-section">
                    <h3>Classes et Interfaces</h3>
                    <div class="class-grid">
        
        <div class="class-card">
            <h3 class="card-title">
                <a href="classes/Structure.html">Structure</a>
            </h3>
            <div class="class-content">
                <div class="outline-text-3" id="text-3-1">
<p>
La classe <code>Structure</code> du sous-paquetage <code>timetable.mapped</code> a pour but de faciliter la description de la structure des données aplaties. Ainsi, une fois terminée, cette classe permet d'écrire le code suivant pour décrire les noms alternatifs des gares :
</p>
<div class="org-src-container">
<pre class="src src-java">int ALIAS_ID = 0;
int STATION_NAME_ID = 1;

Structure STRUCTURE = new Structure(
    field(ALIAS_ID, U16),
    field(STATION_NAME_ID, U16));
</pre>
</div>
<p>
qui est très proche de la table donnée à la §<a href="#sec/aliases">2.4</a>, les constantes <code>ALIAS_ID</code> et <code>STATION_NAME_ID</code> contenant les index (colonne <code>I</code>) des différents champs.
</p>
<p>
Une fois cette définition écrite, il est par exemple possible de calculer l'index, dans le tableau d'octets contenant les données aplaties, du premier octet de l'index de chaîne du nom de gare du second nom alternatif d'une table (celui d'index 1), ainsi :
</p>
<div class="org-src-container">
<pre class="src src-java">int offset = STRUCTURE.offset(STATION_NAME_ID, 1);
</pre>
</div>
<p>
qui vaut 6.
</p>
<p>
<code>Structure</code> possède un type énuméré imbriqué public nommé <code>FieldType</code> représentant les trois types de champs possibles, à savoir <code>U8</code>, <code>U16</code> et <code>S32</code>.
</p>
<p>
De plus, elle possède un enregistrement imbriqué public nommé <code>Field</code>, qui représente un champ et possède les deux attributs suivants, dans l'ordre :
</p>
<dl class="org-dl">
<dt><code>int index</code></dt><dd>l'index du champ dans la structure (colonne <code>I</code> dans les tables plus haut),</dd>
<dt><code>FieldType type</code></dt><dd>le type du champ.</dd>
</dl>
<p>
<code>Field</code> possède un constructeur compact qui lève une <code>NullPointerException</code> ssi <code>type</code> est <code>null</code>.
</p>
<p>
<code>Structure</code> possède de plus une méthode publique et statique dont le but est d'alléger un peu la création d'instances de <code>Field</code>, en omettant le <code>new</code>, comme dans l'exemple plus haut :
</p>
<dl class="org-dl">
<dt><code>Field field(int index, FieldType type)</code></dt><dd>qui retourne une instance de <code>Field</code> avec les attributs donnés.</dd>
</dl>
<p>
<code>Structure</code> possède un unique constructeur, qui prend en arguments la description des différents champs de la structure :
</p>
<dl class="org-dl">
<dt><code>Structure(Field... fields)</code></dt><dd>qui retourne une structure dont les champs sont ceux donnés, ou lève une <code>IllegalArgumentException</code> si ces champs ne sont pas donnés dans l'ordre — c.-à-d. si le premier d'entre eux n'est pas celui d'index 0, le second celui d'index 1, etc.</dd>
<dt><code>int totalSize()</code></dt><dd>qui retourne la taille totale, en octets, de la structure — p. ex. 10 pour celle correspondant aux gares,</dd>
<dt><code>int offset(int fieldIndex, int elementIndex)</code></dt><dd>qui retourne l'index, dans le tableau d'octets contenant les données aplaties, du premier octet du champ d'index <code>fieldIndex</code> de l'élément d'index <code>elementIndex</code> ; lève <code>IndexOutOfBoundsException</code> si l'index du champ est invalide.</dd>
</dl>
</div>
            </div>
        </div>
    
        <div class="class-card">
            <h3 class="card-title">
                <a href="classes/StructuredBuffer.html">StructuredBuffer</a>
            </h3>
            <div class="class-content">
                <div class="outline-text-3" id="text-3-2">
<p>
La classe <code>StructuredBuffer</code> du sous-paquetage <code>timetable.mapped</code>, représente un « tableau d'octets structuré ». Son but est d'offrir un accès agréable à des données aplaties stockées dans un tableau d'octets, et dont la structure est décrite par une instance de <code>Structure</code>.
</p>
<p>
Une fois cette classe terminée, il sera possible de l'utiliser par exemple ainsi pour obtenir l'index de chaîne du nom alternatif d'index 1 :
</p>
<div class="org-src-container">
<pre class="src src-java">StructuredBuffer buffer = …;
int stationNameStringIndex = buffer.getU16(STATION_NAME_ID, 1);
</pre>
</div>
<p>
Dans l'exemple de la §<a href="#sec/example">2.6</a>, <code>stationNameStringIndex</code> vaudrait 3, car c'est l'index de chaîne <i>Ins</i>.
</p>
<p>
<code>StructuredBuffer</code> possède un unique constructeur public :
</p>
<dl class="org-dl">
<dt><code>StructuredBuffer(Structure structure, ByteBuffer buffer)</code></dt><dd>qui construit un tableau structuré dont les éléments ont la structure donnée, et dont les octets sont stockés dans le « tableau » <code>buffer</code>, ou lève une <code>IllegalArgumentException</code> si le nombre d'octets de ce tableau n'est pas un multiple de la taille totale de la structure.</dd>
</dl>
<p>
La classe <code>ByteBuffer</code>, qui appartient à la bibliothèque Java, est décrite dans les conseils de programmation ci-dessous.
</p>
<p>
En plus de son constructeur, <code>StructuredBuffer</code> offre les méthodes publiques suivantes :
</p>
<dl class="org-dl">
<dt><code>int size()</code></dt><dd>qui retourne le nombre d'éléments que contient le tableau, p. ex. 3 pour les voies/quais de la §<a href="#sec/example">2.6</a>,</dd>
<dt><code>int getU8(int fieldIndex, int elementIndex)</code></dt><dd>qui retourne l'entier <code>U8</code> correspondant au champ d'index <code>fieldIndex</code> de l'élément d'index <code>elementIndex</code> du tableau, ou lève <code>IndexOutOfBoundsException</code> si l'un des deux index est invalide,</dd>
<dt><code>int getU16(int fieldIndex, int elementIndex)</code></dt><dd>qui fait la même chose que <code>getU8</code> mais pour un champ de type <code>U16</code>,</dd>
<dt><code>int getS32(int fieldIndex, int elementIndex)</code></dt><dd>qui fait la même chose que <code>getU8</code> mais pour un champ de type <code>S32</code>.</dd>
</dl>
<p>
N'oubliez pas que les valeurs retournées par <code>getU8</code> et <code>getU16</code> doivent être positives, car les champs de ces deux types sont interprétés de manière non signée. C'est la raison pour laquelle ces méthodes retournent une valeur de type <code>int</code> et pas <code>byte</code> ou <code>short</code>.
</p>
</div>
            </div>
        </div>
    
        <div class="class-card">
            <h3 class="card-title">
                <a href="classes/BufferedStations.html">BufferedStations</a>
            </h3>
            <div class="class-content">
                <div class="outline-text-3" id="text-3-3">
<p>
La classe <code>BufferedStations</code> du sous-paquetage <code>timetable.mapped</code>, publique et finale, implémente l'interface <code>Stations</code> et permet d'accéder à une table de gares représentée de manière aplatie comme décrit à la §<a href="#sec/stations">2.3</a>. Elle possède un unique constructeur public :
</p>
<dl class="org-dl">
<dt><code>BufferedStations(List&lt;String&gt; stringTable, ByteBuffer buffer)</code></dt><dd>qui construit une instance donnant accès aux données aplaties disponibles dans le tableau <code>buffer</code>, en utilisant la table de chaînes <code>stringTable</code> pour déterminer la valeur des chaînes référencées par ces données.</dd>
</dl>
<p>
Les seules méthodes publiques offertes par cette classe sont les versions concrètes des méthodes abstraites de <code>Stations</code>.
</p>
</div>
            </div>
        </div>
    
        <div class="class-card">
            <h3 class="card-title">
                <a href="classes/BufferedStationAliases.html">BufferedStationAliases</a>
            </h3>
            <div class="class-content">
                <div class="outline-text-3" id="text-3-4">
<p>
La classe <code>BufferedStationAliasess</code> du sous-paquetage <code>timetable.mapped</code>, publique et finale, implémente l'interface <code>StationAliases</code> et permet d'accéder à une table de noms alternatifs de gares représentée de manière aplatie comme décrit à la §<a href="#sec/aliases">2.4</a>. Elle possède un unique constructeur public :
</p>
<dl class="org-dl">
<dt><code>BufferedStationAliases(List&lt;String&gt; stringTable, ByteBuffer buffer)</code></dt><dd>qui construit une instance donnant accès aux données aplaties disponibles dans le tableau <code>buffer</code>, en utilisant la table de chaînes <code>stringTable</code> pour déterminer la valeur des chaînes référencées par ces données.</dd>
</dl>
<p>
Les seules méthodes publiques offertes par cette classe sont les versions concrètes des méthodes abstraites de <code>StationAliases</code>.
</p>
</div>
            </div>
        </div>
    
        <div class="class-card">
            <h3 class="card-title">
                <a href="classes/BufferedPlatforms.html">BufferedPlatforms</a>
            </h3>
            <div class="class-content">
                <div class="outline-text-3" id="text-3-5">
<p>
La classe <code>BufferedPlatforms</code> du sous-paquetage <code>timetable.mapped</code>, publique et finale, implémente l'interface <code>Platforms</code> et permet d'accéder à une table de voies ou quais représentée de manière aplatie comme décrit à la §<a href="#sec/platforms">2.5</a>. Elle possède un unique constructeur public :
</p>
<dl class="org-dl">
<dt><code>BufferedPlatforms(List&lt;String&gt; stringTable, ByteBuffer buffer)</code></dt><dd>qui construit une instance donnant accès aux données aplaties disponibles dans le tableau <code>buffer</code>, en utilisant la table de chaînes <code>stringTable</code> pour déterminer la valeur des chaînes référencées par ces données.</dd>
</dl>
<p>
Les seules méthodes publiques offertes par cette classe sont les versions concrètes des méthodes abstraites de <code>Platforms</code>.
</p>
</div>
            </div>
        </div>
    
                    </div>
                </div>
        
    </div>
</body>
</html>
